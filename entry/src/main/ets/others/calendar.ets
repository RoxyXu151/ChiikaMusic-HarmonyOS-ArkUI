import router from '@ohos.router';

@Entry
@Component
struct Calendars {
  @State currentMonth: string = 'February';
  @State currentYear: string = '2021';
  @State selectedDate: number = 3; // é»˜è®¤é€‰ä¸­æ—¥æœŸ
  @State currentView: string = 'Week'; // å½“å‰è§†å›¾æ¨¡å¼ï¼šDay, Week, Month, Year
  @State currentWeekDates: number[] = [21, 22, 23, 24, 25, 26, 27]; // å½“å‰å‘¨çš„æ—¥æœŸ
  @State searchText: string = ''; // æœç´¢æ–‡æœ¬
  @State isMenuCollapsed: boolean = false; // æ§åˆ¶å·¦ä¾§èœå•æ˜¯å¦æ”¶ç¼©
  
  // æ—¥å†æ•°æ®
  private daysOfWeek: string[] = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
  private daysInMonth: number[] = [31, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28];
  
  // äº‹ä»¶æ•°æ®ç¤ºä¾‹
  private eventDots: Map<number, number[]> = new Map([
    [1, [0, 1, 2]], // æ—¥æœŸ1æœ‰3ä¸ªäº‹ä»¶ï¼Œé¢œè‰²ç´¢å¼•åˆ†åˆ«ä¸º0,1,2
    [2, [0, 1, 2]],
    [3, [0, 1, 2]],
    [4, [0, 1, 2]],
    [5, [0, 1, 2]]
  ]);
  
  // äº‹ä»¶é¢œè‰²
  private eventColors: string[] = ['#FF5C00', '#0A84FF', '#30D158'];
  
  // æ—¥ç¨‹äº‹ä»¶æ•°æ®
  private events: Event[] = [
    { day: 22, startTime: '8:00 AM', endTime: '9:00 AM', title: 'Monday Wake-Up Hour', color: '#0A84FF' },
    { day: 22, startTime: '9:00 AM', endTime: '10:00 AM', title: 'All-Team Kickoff', color: '#0A84FF' },
    { day: 22, startTime: '10:00 AM', endTime: '11:00 AM', title: 'Financial Update', color: '#0A84FF' },
    { day: 22, startTime: '11:00 AM', endTime: '12:00 PM', title: 'New Employee Welcome Lunch!', color: '#BF5AF2', icon: 'ğŸ•' },
    { day: 22, startTime: '1:00 PM', endTime: '2:00 PM', title: 'Design Review', color: '#0A84FF' },
    { day: 22, startTime: '2:00 PM', endTime: '3:00 PM', title: '1:1 with Jon', color: '#FF9F0A' },
    
    { day: 23, startTime: '9:00 AM', endTime: '10:00 AM', title: 'Design Review: Acme Marketing', color: '#0A84FF' },
    { day: 23, startTime: '12:00 PM', endTime: '1:00 PM', title: 'Design System Kickoff Lunch', color: '#0A84FF', icon: 'ğŸ“' },
    { day: 23, startTime: '2:00 PM', endTime: '3:00 PM', title: 'Concept Design Review II', color: '#0A84FF' },
    { day: 23, startTime: '4:00 PM', endTime: '5:00 PM', title: 'Design Team Happy Hour', color: '#FF2D55', icon: 'ğŸ¨' },
    
    { day: 24, startTime: '9:00 AM', endTime: '10:00 AM', title: 'Webinar: Figma ...', color: '#30D158' },
    { day: 24, startTime: '1:00 PM', endTime: '2:00 PM', title: 'MVP Prioritization Workshop', color: '#0A84FF' },
    
    { day: 25, startTime: '9:00 AM', endTime: '10:00 AM', title: 'Coffee Chat', color: '#0A84FF', icon: 'â˜•' },
    { day: 25, startTime: '10:00 AM', endTime: '11:00 AM', title: 'Health Benefits Walkthrough', color: '#BF5AF2' },
    { day: 25, startTime: '11:00 AM', endTime: '12:00 PM', title: 'Onboarding Presentation', color: '#BF5AF2' },
    
    { day: 26, startTime: '9:00 AM', endTime: '10:00 AM', title: 'Coffee Chat', color: '#0A84FF', icon: 'â˜•' },
    { day: 26, startTime: '12:00 PM', endTime: '1:00 PM', title: 'Marketing Meet-and-Greet', color: '#0A84FF', icon: 'ğŸ’¬' },
    { day: 26, startTime: '1:00 PM', endTime: '2:00 PM', title: 'Design Review', color: '#0A84FF' },
    { day: 26, startTime: '2:00 PM', endTime: '3:00 PM', title: '1:1 with Heather', color: '#FF9F0A' },
    { day: 26, startTime: '4:00 PM', endTime: '5:00 PM', title: 'Happy Hour', color: '#FF2D55', icon: 'ğŸ¥‚' }
  ];
  
  // æ—¶é—´æ®µ
  private timeSlots: string[] = [
    '7 AM', '8 AM', '9 AM', '10 AM', '11 AM', '12 PM',
    '1 PM', '2 PM', '3 PM', '4 PM', '5 PM'
  ];
  
  // è·å–æŒ‡å®šæ—¥æœŸçš„äº‹ä»¶
  private getEventsForDay(day: number) {
    return this.events.filter(event => event.day === day);
  }
  
  // è·å–äº‹ä»¶åœ¨æ—¶é—´è¡¨ä¸­çš„ä½ç½®
  private getEventPosition(startTime: string): number {
    const hour = parseInt(startTime.split(':')[0]);
    const ampm = startTime.includes('AM') ? 'AM' : 'PM';
    let position = this.timeSlots.findIndex(slot => slot === `${hour} ${ampm}`);
    return position >= 0 ? position : 0;
  }
  
  build() {
    Column() {
      Row() {
        // å·¦ä¾§èœå•
        Stack({ alignContent: Alignment.TopEnd }) {
          Column() {
            // é¡¶éƒ¨èœå•
            Row() {
              // å½©è‰²åœ†ç‚¹
              Row() {
                Circle({ width: 6, height: 6 })
                  .fill('#FF5C00')
                  .stroke('#FFFFFF')
                  .strokeWidth(0.5)
                  .margin({ right: 6 })
                
                Circle({ width: 6, height: 6 })
                  .fill('#0A84FF')
                  .stroke('#FFFFFF')
                  .strokeWidth(0.5)
                  .margin({ right: 6 })
                
                Circle({ width: 6, height: 6 })
                  .fill('#30D158')
                  .stroke('#FFFFFF')
                  .strokeWidth(0.5)
              }
              .width(80)
              .justifyContent(FlexAlign.Start)
              
              // èœå•å›¾æ ‡
              Image($r('app.media.menu_icon'))
                .width(12)
                .height(12)
                .margin({ left: 'auto' })
            }
            .width(160)
            .padding({ top: 12, bottom: 12, left: 10, right: 10 })
            
            if (!this.isMenuCollapsed) {
              // æ—¥æœŸé€‰æ‹©å™¨
              Column() {
                Row() {
                  Text(this.currentMonth)
                    .fontSize(11)
                    .fontWeight(FontWeight.Bold)
                    .fontColor('#000000')
                  
                  Text(this.currentYear)
                    .fontSize(11)
                    .fontWeight(FontWeight.Bold)
                    .fontColor('#8E8E93')
                    .margin({ left: 6 })
                }
                .width(160)
                
                Row() {
                  Image($r('app.media.chevron_left'))
                    .width(12)
                    .height(12)
                    .onClick(() => {
                      // ä¸Šä¸ªæœˆé€»è¾‘
                    })
                  
                  Image($r('app.media.chevron_right'))
                    .width(12)
                    .height(12)
                    .onClick(() => {
                      // ä¸‹ä¸ªæœˆé€»è¾‘
                    })
                }
                .width(160)
                .justifyContent(FlexAlign.End)
                .margin({ top: 6 })
              }
              .width(160)
              .padding({ left: 10, right: 10, bottom: 10 })
              
              // è¿·ä½ æ—¥å†
              Column() {
                // æ˜ŸæœŸæ ‡é¢˜
                Row() {
                  ForEach(this.daysOfWeek, (day: string) => {
                    Text(day)
                      .fontSize(6)
                      .fontWeight(FontWeight.Medium)
                      .fontColor('#8E8E93')
                      .width(20)
                      .textAlign(TextAlign.Center)
                  })
                }
                .width(160)
                .padding({ top: 6, bottom: 6 })
                
                // æ—¥æœŸç½‘æ ¼
                Flex({ direction: FlexDirection.Row, wrap: FlexWrap.Wrap }) {
                  ForEach(this.daysInMonth, (day: number, index: number) => {
                    Column() {
                      Text(day.toString())
                        .fontSize(8)
                        .fontWeight(FontWeight.Medium)
                        .fontColor(day === this.selectedDate ? '#007AFF' : '#000000')
                        .width(14)
                        .height(14)
                        .textAlign(TextAlign.Center)
                      
                      // äº‹ä»¶æŒ‡ç¤ºç‚¹
                      if (this.eventDots.has(day)) {
                        Row() {
                          ForEach(this.eventDots.get(day), (colorIndex: number) => {
                            Circle({ width: 2.5, height: 2.5 })
                              .fill(this.eventColors[colorIndex])
                              .margin({ right: 1.5 })
                          })
                        }
                        .height(2.5)
                        .margin({ top: 3 })
                      }
                    }
                    .width(20)
                    .height(24)
                    .justifyContent(FlexAlign.Center)
                    .alignItems(HorizontalAlign.Center)
                    .onClick(() => {
                      this.selectedDate = day;
                    })
                  })
                }
                .width(160)
              }
              .width(160)
              .padding({ left: 10, right: 10 })
            }
          }
          .width(this.isMenuCollapsed ? 30 : 160)
          .height(600)
          .backgroundColor('#F2F2F7')
          
          // æ”¶ç¼©æŒ‰é’®
          Button({
            type: ButtonType.Circle,
            stateEffect: true
          }) {
            Image(this.isMenuCollapsed ? $r('app.media.chevron_right') : $r('app.media.chevron_left'))
              .width(8)
              .height(8)
              .fillColor('#000000')
          }
          .width(16)
          .height(16)
          .backgroundColor('#FFFFFF')
          .margin({ top: 40, right: -8 })
          .onClick(() => {
            this.isMenuCollapsed = !this.isMenuCollapsed;
          })
        }
        
        // å³ä¾§ä¸»æ—¥å†åŒºåŸŸ
        Column() {
          // é¡¶éƒ¨å¯¼èˆªæ 
          Row() {
            // å·¦ä¾§å¯¼èˆªæŒ‰é’®
            Row() {
              // ä»Šå¤©æŒ‰é’®
              Button('Today')
                .fontSize(7)
                .fontWeight(FontWeight.Medium)
                .backgroundColor('#FFFFFF')
                .fontColor('#000000')
                .borderRadius(3)
                .height(18)
                .padding({ left: 8, right: 8 })
              
              // å‰åå¯¼èˆªç®­å¤´
              Row() {
                Image($r('app.media.chevron_left'))
                  .width(12)
                  .height(12)
                  .margin({ right: 10 })
                
                Image($r('app.media.chevron_right'))
                  .width(12)
                  .height(12)
              }
              .margin({ left: 10 })
            }
            
            // ä¸­é—´è§†å›¾é€‰æ‹©å™¨
            Row() {
              ForEach(['Day', 'Week', 'Month', 'Year'], (view: string) => {
                Text(view)
                  .fontSize(7)
                  .fontWeight(FontWeight.Medium)
                  .fontColor(this.currentView === view ? '#FFFFFF' : '#000000')
                  .backgroundColor(this.currentView === view ? '#E5484D' : '#FFFFFF')
                  .borderRadius(3)
                  .height(18)
                  .padding({ left: 8, right: 8 })
                  .textAlign(TextAlign.Center)
                  .margin({ right: view !== 'Year' ? 4 : 0 })
                  .onClick(() => {
                    this.currentView = view;
                  })
              })
            }
            .justifyContent(FlexAlign.Center)
            
            // å³ä¾§æœç´¢æ¡†
            Search({ placeholder: 'Search', value: this.searchText })
              .width(100)
              .height(18)
              .backgroundColor('#F2F2F7')
              .borderRadius(4)
              .onChange((value: string) => {
                this.searchText = value;
              })
          }
          .width(400)
          .justifyContent(FlexAlign.SpaceBetween)
          .padding({ top: 10, bottom: 10, left: 10, right: 10 })
          
          // å‘¨è§†å›¾
          Column() {
            // æ˜ŸæœŸå’Œæ—¥æœŸæ ‡é¢˜
            Row() {
              // æ—¶åŒºä¿¡æ¯
              Column() {
                Text('EST')
                  .fontSize(6)
                  .fontColor('#8E8E93')
                  .textAlign(TextAlign.End)
                
                Text('GMT-5')
                  .fontSize(6)
                  .fontColor('#8E8E93')
                  .textAlign(TextAlign.End)
              }
              .width(32)
              .alignItems(HorizontalAlign.End)
              .padding({ right: 6 })
              
              // æ˜ŸæœŸå’Œæ—¥æœŸ
              ForEach(this.daysOfWeek, (day: string, index: number) => {
                Column() {
                  Text(day)
                    .fontSize(6)
                    .fontColor('#8E8E93')
                    .textAlign(TextAlign.Center)
                  
                  Text(this.currentWeekDates[index].toString())
                    .fontSize(12)
                    .fontWeight(FontWeight.Bold)
                    .textAlign(TextAlign.Center)
                    .margin({ top: 2 })
                }
                .width(52)
                .padding({ top: 6, bottom: 6 })
                .backgroundColor(index === 4 ? '#F2F2F7' : '#FFFFFF') // é«˜äº®å½“å‰æ—¥æœŸ
              })
            }
            .width(400)
            
            // æ—¶é—´è¡¨æ ¼
            List() {
              ForEach(this.timeSlots, (time: string, timeIndex: number) => {
                ListItem() {
                  Row() {
                    // æ—¶é—´æ ‡ç­¾
                    Text(time)
                      .fontSize(6)
                      .fontColor('#8E8E93')
                      .width(32)
                      .textAlign(TextAlign.End)
                      .padding({ right: 6 })
                    
                    // æ—¶é—´æ ¼å­
                    Row() {
                      ForEach(this.currentWeekDates, (day: number, dayIndex: number) => {
                        Stack({ alignContent: Alignment.TopStart }) {
                          // èƒŒæ™¯
                          Column()
                            .width(52)
                            .height(45)
                            .backgroundColor(dayIndex === 4 ? '#F2F2F7' : '#FFFFFF') // é«˜äº®å½“å‰æ—¥æœŸåˆ—
                            .border({ width: { top: 0.5, right: 0.5 }, color: '#E5E5EA', style: BorderStyle.Solid })
                          
                          // äº‹ä»¶
                          ForEach(this.getEventsForDay(day), (event: Event) => {
                            if (this.getEventPosition(event.startTime) === timeIndex) {
                              Column() {
                                Row() {
                                  // äº‹ä»¶å›¾æ ‡
                                  if (event.icon) {
                                    Text(event.icon)
                                      .fontSize(7)
                                      .margin({ right: 3 })
                                  }
                                  
                                  // äº‹ä»¶æ—¶é—´
                                  Text(event.startTime)
                                    .fontSize(6)
                                    .fontColor('#FFFFFF')
                                    .fontWeight(FontWeight.Medium)
                                  
                                  if (event.icon) {
                                    Text(' ')
                                      .fontSize(6)
                                  }
                                }
                                .width(46)
                                
                                // äº‹ä»¶æ ‡é¢˜
                                Text(event.title)
                                  .fontSize(7)
                                  .fontColor('#FFFFFF')
                                  .fontWeight(FontWeight.Medium)
                                  .margin({ top: 3 })
                              }
                              .width(46)
                              .padding(5)
                              .backgroundColor(event.color)
                              .borderRadius(4)
                              .margin({ top: 3, bottom: 3 })
                            }
                          })
                        }
                        .width(52)
                        .height(45)
                      })
                    }
                    .width(368)
                    .height(45)
                  }
                  .width(400)
                }
                .width(400)
              })
            }
            .width(400)
            .height(510)
          }
          .width(400)
          .height(600)
        }
        .width(400)
        .height(600)
        .backgroundColor('#FFFFFF')
      }
      .width(560)
      .height(600)
    }
    .width(560)
    .height(600)
  }
}

interface Event {
  day: number,
  startTime: string,
  endTime: string,
  title: string,
  description?: string,
  color: string,
  icon?: string
}